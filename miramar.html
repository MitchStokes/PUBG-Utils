<!DOCTYPE html>

<html>


    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">

    </head>


    <body>

        <svg id="map" width="1000" height="1000">
            <image href="res/Miramar_PNG.png" x="0" y="0" width="1000" height="1000" />
        </svg>

        <script>

            async function getMatchData() {
                return fetch('/res/match_data.csv')
                .then( response => response.text() )
                .then( text => {
                    let lines = text.split( '\r\n' );
                    let matchData = [];
                    lines.forEach(line => {
                        let lineData = line.split( ',' );
                        let curObj = {};
                        curObj.matchId = lineData[0];
                        curObj.centerX = lineData[1];
                        curObj.centerY = lineData[2];
                        curObj.map = lineData[3];
                        curObj.time = lineData[4];
                        curObj.matchName = lineData[5];
                        curObj.matchLink = 'https://analytics.twire.gg/en/pubg/match/' + curObj.matchId;
                        matchData.push( curObj );
                    });
                    return matchData;
                } );
            }

            getMatchData().then(data => {
                data.forEach(match => {
                    if( match['map'] == 'Miramar' ) {
                        var svgns = "http://www.w3.org/2000/svg";

                        var rect = document.createElementNS( svgns,'rect' );
                        rect.setAttributeNS( null, 'x', (1000/700) * match.centerX );
                        rect.setAttributeNS( null, 'y', (1000/700) * match.centerY );
                        rect.setAttributeNS( null, 'width', 10 );
                        rect.setAttributeNS( null, 'height', 10 );
                        rect.setAttributeNS( null, 'fill', '#' + Math.round( 0xffffff * Math.random()).toString(16) );
                        rect.addEventListener( 'click', function() {
                            window.open( match.matchLink, "_blank" );
                        } );

                        document.getElementById( 'map' ).appendChild( rect );
                    }
                });
            });

        </script>

    </body>


</html>